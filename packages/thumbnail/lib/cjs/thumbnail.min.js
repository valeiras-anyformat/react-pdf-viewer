"use strict";var e=require("@react-pdf-viewer/core");function t(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var a=t(require("react")),n=(e=>(e.Horizontal="Horizontal",e.Vertical="Vertical",e))(n||{}),r="rpv_34a2d621",i="rpv_6f09fae9",o="rpv_34f6d0c0",s="rpv_34f62bc5";
/**
 * A React component to view a PDF document
 *
 * @see https://react-pdf-viewer.dev
 * @license https://react-pdf-viewer.dev/license
 * @copyright 2019-2024 Nguyen Huu Phuoc <me@phuoc.ng>
 */const c=({doc:t,getPageIndex:n,renderSpinner:r,store:c,width:u})=>{const{numPages:l}=t,d=n?n({numPages:l}):0,g=Math.max(0,Math.min(d,l-1)),h=c.get("pagesRotation")||new Map,p=h.has(g)?h.get(g):0,[b,m]=e.useSafeState(""),f=a.useRef(),[v,P]=a.useState(c.get("rotation")||0),[w,E]=a.useState(p),[_,R]=a.useState(!1),S=e=>{const t=e.has(g)?e.get(g):0;E(t)},C=e=>{P(e)},x=e.useIntersectionObserver({onVisibilityChanged:e=>{R(e.isVisible)}});return a.useEffect((()=>{if(!_)return;const a=x.current;a&&(m(""),e.getPage(t,g).then((e=>{const t=e.getViewport({scale:1}),n=(t.rotation+v+w)%360,r=Math.abs(v+w)%180==0,i=r?t.width:t.height,o=r?t.height:t.width,s=document.createElement("canvas"),c=s.getContext("2d",{alpha:!1});if(!c)return;const l=a.clientWidth,d=a.clientHeight,g=u?u/i:Math.min(l/i,d/o),h=g*i,p=g*o;s.height=p,s.width=h,s.style.opacity="0";const b=e.getViewport({rotation:n,scale:g});f.current=e.render({canvasContext:c,viewport:b}),f.current.promise.then((()=>{m(s.toDataURL()),s.width=0,s.height=0}),(()=>{}))})))}),[w,_]),a.useEffect((()=>(c.subscribe("pagesRotation",S),c.subscribe("rotation",C),()=>{c.unsubscribe("pagesRotation",S),c.unsubscribe("rotation",C)})),[]),a.useEffect((()=>()=>{f.current?.cancel()}),[]),a.createElement("div",{ref:x,className:o,"data-testid":"thumbnail__cover-inner"},b?a.createElement("img",{className:s,"data-testid":"thumbnail__cover-image",src:b}):a.createElement("div",{className:i,"data-testid":"thumbnail__cover-loader"},r?r():a.createElement(e.Spinner,null)))},u=({getPageIndex:t,renderSpinner:n,store:o,width:s})=>{const[u,l]=a.useState(o.get("doc")),d=e=>{l(e)};return a.useEffect((()=>(o.subscribe("doc",d),()=>{o.unsubscribe("doc",d)})),[]),a.createElement("div",{className:r},u?a.createElement(c,{doc:u,getPageIndex:t,renderSpinner:n,store:o,width:s}):a.createElement("div",{className:i},n?n():a.createElement(e.Spinner,null)))},l=()=>a.createElement(e.Spinner,null),d=a.createContext({renderSpinner:l}),g=({children:t,doc:n})=>{const[r,i]=e.useSafeState({loading:!0,labels:[]});return a.useEffect((()=>{n.getPageLabels().then((e=>{i({loading:!1,labels:e||[]})}))}),[n.loadingTask.docId]),r.loading?a.createElement(a.Fragment,null):t(r.labels)},h=({page:t,pageHeight:n,pageIndex:r,pageWidth:i,rotation:o,thumbnailHeight:s,thumbnailWidth:c,onRenderCompleted:u})=>{const{l10n:l}=a.useContext(e.LocalizationContext),g=a.useRef(),[h,p]=a.useState(""),b=l&&l.thumbnail?l.thumbnail.thumbnailLabel:"Thumbnail of page {{pageIndex}}";return a.useEffect((()=>{const e=g.current;e&&e.cancel();const a=document.createElement("canvas"),s=a.getContext("2d",{alpha:!1});if(!s)return;const l=c,d=l/(i/n),h=l/i;a.height=d,a.width=l,a.style.height=`${d}px`,a.style.width=`${l}px`;const b=t.getViewport({rotation:o,scale:h});return g.current=t.render({canvasContext:s,viewport:b}),g.current.promise.then((()=>{p(a.toDataURL()),u(r)}),(()=>{u(r)})),()=>{g.current?.cancel()}}),[o]),h?a.createElement("img",{"aria-label":b.replace("{{pageIndex}}",`${r+1}`),src:h,height:`${s}px`,width:`${c}px`}):a.useContext(d).renderSpinner()};var p="rpv_87cfa5a9";const b=({doc:t,pageHeight:n,pageIndex:r,pageRotation:i,pageWidth:o,rotation:s,shouldRender:c,thumbnailWidth:u,onRenderCompleted:l,onVisibilityChanged:g})=>{const[b,m]=e.useSafeState({height:n,page:null,viewportRotation:0,width:o}),{page:f,height:v,width:P}=b,w=P/v,E=Math.abs(s+i)%180==0,_=E?u:u/w,R=E?u/w:u;a.useEffect((()=>{c&&e.getPage(t,r).then((e=>{const t=e.getViewport({scale:1});m({height:t.height,page:e,viewportRotation:t.rotation,width:t.width})}))}),[c]);const S=(b.viewportRotation+s+i)%360,C=e.useIntersectionObserver({onVisibilityChanged:e=>{g(r,e)}});return a.createElement("div",{className:p,"data-testid":`thumbnail__container-${r}`,ref:C,style:{height:`${R}px`,width:`${_}px`}},f?a.createElement(h,{page:f,pageHeight:E?v:P,pageIndex:r,pageWidth:E?P:v,rotation:S,thumbnailHeight:R,thumbnailWidth:_,onRenderCompleted:l}):a.useContext(d).renderSpinner())};
/**
 * A React component to view a PDF document
 *
 * @see https://react-pdf-viewer.dev
 * @license https://react-pdf-viewer.dev/license
 * @copyright 2019-2024 Nguyen Huu Phuoc <me@phuoc.ng>
 */var m="rpv_fcb6421e",f="rpv_5d99636c",v="rpv_43a01ce2",P="rpv_78f00fb4",w="rpv_8b9d9a73",E="rpv_f5b5d58f",_="rpv_db36b756",R="rpv_c390af68",S="rpv_806cf3e",C="rpv_959661e5",x="rpv_702f252c",M="rpv_a72b4d0a",V="rpv_f31a6edd",I="rpv_3e3a0c9f",W="rpv_4a6d5811",y="rpv_8bc1cb11";const D=({currentPage:t,doc:r,labels:i,pagesRotation:o,pageHeight:s,pageWidth:c,renderCurrentPageLabel:u,renderThumbnailItem:l,rotatedPage:d,rotation:g,thumbnailDirection:h,thumbnailWidth:p,viewMode:D,onJumpToPage:T,onRotatePage:k})=>{const{numPages:L}=r,H=r.loadingTask.docId,N=a.useRef(null),$=a.useRef([]),[O,j]=a.useState(t),{direction:A}=a.useContext(e.ThemeContext),z=A===e.TextDirection.RightToLeft,[B,q]=a.useState(-1),J=e.useIsMounted(),U=e.usePrevious(D),F=a.useRef(!1),K=e.useRenderQueue({doc:r}),Q=a.useMemo((()=>Array(L).fill(0).map(((e,t)=>t))),[H]),G=a.useMemo((()=>{switch(D){case e.ViewMode.DualPage:return e.chunk(Q,2);case e.ViewMode.DualPageWithCover:return[[Q[0]]].concat(e.chunk(Q.slice(1),2));case e.ViewMode.SinglePage:default:return e.chunk(Q,1)}}),[H,D]),X=()=>{if(!N.current)return;const e=$.current,t=O+1;t<e.length&&(O>=0&&e[O].setAttribute("tabindex","-1"),j(t))},Y=()=>{if(!N.current)return;const e=$.current,t=O-1;t>=0&&(O>=0&&e[O].setAttribute("tabindex","-1"),j(t))},Z=()=>{O>=0&&O<L&&T(O)};e.useIsomorphicLayoutEffect((()=>{const e=N.current;e&&($.current=Array.from(e.querySelectorAll(`.${_}`)))}),[D]),a.useEffect((()=>{const e=$.current;if(0===e.length||O<0||O>e.length)return;const t=e[O];t.setAttribute("tabindex","0"),t.focus()}),[O]),e.useIsomorphicLayoutEffect((()=>{const e=N.current,a=$.current;if(!e||0===a.length||t<0||t>a.length)return;const r=a[t].closest(`.${w}`);r&&(h===n.Vertical?((e,t)=>{const a=e.getBoundingClientRect().top-t.getBoundingClientRect().top,n=e.clientHeight,r=t.clientHeight;a<0?t.scrollTop+=a:a+n<=r||(t.scrollTop+=a+n-r)})(r,e):((e,t)=>{const a=e.getBoundingClientRect().left-t.getBoundingClientRect().left,n=e.clientWidth,r=t.clientWidth;a<0?t.scrollLeft+=a:a+n<=r||(t.scrollLeft+=a+n-r)})(r,e))}),[t,h]);const ee=a.useCallback((e=>{J.current&&(K.markRendered(e),F.current=!1,ae())}),[H]),te=a.useCallback(((e,t)=>{t.isVisible?K.setVisibility(e,t.ratio):K.setOutOfRange(e),ae()}),[H]),ae=a.useCallback((()=>{if(F.current)return;const e=K.getHighestPriorityPage();e>-1&&(K.markRendering(e),F.current=!0,q(e))}),[H]);a.useEffect((()=>{d>=0&&(K.markRendering(d),F.current=!0,q(d))}),[H,d]),e.useIsomorphicLayoutEffect((()=>{U!==D&&(K.markNotRendered(),ae())}),[D]);return a.createElement("div",{ref:N,"data-testid":"thumbnail__list",className:e.classNames({[m]:!0,[v]:h===n.Horizontal,[f]:z,[P]:h===n.Vertical}),onKeyDown:e=>{switch(e.key){case"ArrowDown":X();break;case"ArrowUp":Y();break;case"Enter":Z()}}},G.map(((n,d)=>{switch(D){case e.ViewMode.DualPage:case e.ViewMode.DualPageWithCover:case e.ViewMode.SinglePage:}return a.createElement("div",{className:e.classNames({[w]:!0,[E]:D===e.ViewMode.DualPage,[R]:D===e.ViewMode.DualPageWithCover}),key:`${d}___${D}`},n.map((n=>(n=>{const d=D===e.ViewMode.DualPageWithCover&&(0===n||L%2==0&&n===L-1),h=`${r.loadingTask.docId}___${n}`,m=i.length===L?i[n]:`${n+1}`,f=u?u({currentPage:t,pageIndex:n,numPages:L,pageLabel:m}):m,v=o.has(n)?o.get(n):0,P=a.createElement(b,{doc:r,pageHeight:s,pageIndex:n,pageRotation:v,pageWidth:c,rotation:g,shouldRender:B===n,thumbnailWidth:p,onRenderCompleted:ee,onVisibilityChanged:te});return l?l({currentPage:t,key:h,numPages:L,pageIndex:n,renderPageLabel:a.createElement(a.Fragment,null,f),renderPageThumbnail:P,onJumpToPage:()=>T(n),onRotatePage:e=>k(n,e)}):a.createElement("div",{key:h},a.createElement("div",{className:e.classNames({[_]:!0,[x]:D===e.ViewMode.DualPage&&n%2==0,[V]:D===e.ViewMode.DualPage&&n%2==1,[C]:d,[I]:D===e.ViewMode.DualPageWithCover&&!d&&n%2==0,[M]:D===e.ViewMode.DualPageWithCover&&!d&&n%2==1,[S]:D===e.ViewMode.SinglePage,[W]:t===n}),role:"button",tabIndex:t===n?0:-1,onClick:()=>T(n)},P),a.createElement("div",{"data-testid":`thumbnail__label-${n}`,className:y},f))})(n))))})))};var T="rpv_16d088e5",k="rpv_3031ee2f";const L=({renderCurrentPageLabel:t,renderThumbnailItem:n,store:r,thumbnailDirection:i,thumbnailWidth:o})=>{const[s,c]=a.useState(r.get("doc")),[u,l]=a.useState(r.get("currentPage")||0),[h,p]=a.useState(r.get("pageHeight")||0),[b,m]=a.useState(r.get("pageWidth")||0),[f,v]=a.useState(r.get("rotation")||0),[P,w]=a.useState(r.get("pagesRotation")||new Map),[E,_]=a.useState(r.get("rotatedPage")||-1),[R,S]=a.useState(r.get("viewMode")),C=e=>{l(e)},x=e=>{c(e)},M=e=>{p(e)},V=e=>{m(e)},I=e=>{v(e)},W=e=>{w(e)},y=e=>{_(e)},L=e=>{S(e)},H=e=>{const t=r.get("jumpToPage");t&&t(e)},N=(e,t)=>{r.get("rotatePage")(e,t)};return a.useEffect((()=>(r.subscribe("doc",x),r.subscribe("pageHeight",M),r.subscribe("pageWidth",V),r.subscribe("rotatedPage",y),r.subscribe("rotation",I),r.subscribe("pagesRotation",W),r.subscribe("viewMode",L),()=>{r.unsubscribe("doc",x),r.unsubscribe("pageHeight",M),r.unsubscribe("pageWidth",V),r.unsubscribe("rotatedPage",y),r.unsubscribe("rotation",I),r.unsubscribe("pagesRotation",W),r.unsubscribe("viewMode",L)})),[]),e.useIsomorphicLayoutEffect((()=>(r.subscribe("currentPage",C),()=>{r.unsubscribe("currentPage",C)})),[]),s?a.createElement(e.LazyRender,{testId:"thumbnail__list-container",attrs:{className:T}},a.createElement(g,{doc:s},(e=>a.createElement(D,{currentPage:u,doc:s,labels:e,pagesRotation:P,pageHeight:h,pageWidth:b,renderCurrentPageLabel:t,renderThumbnailItem:n,rotatedPage:E,rotation:f,thumbnailDirection:i,thumbnailWidth:o,viewMode:R,onJumpToPage:H,onRotatePage:N})))):a.createElement("div",{"data-testid":"thumbnail-list__loader",className:k},a.useContext(d).renderSpinner())};exports.ThumbnailDirection=n,exports.thumbnailPlugin=t=>{const r=a.useMemo((()=>e.createStore({rotatePage:()=>{},viewMode:e.ViewMode.SinglePage})),[]),[i,o]=a.useState("");return{install:e=>{r.update("jumpToPage",e.jumpToPage),r.update("rotatePage",e.rotatePage)},onDocumentLoad:e=>{o(e.doc.loadingTask.docId),r.update("doc",e.doc)},onViewerStateChange:e=>(r.update("currentPage",e.pageIndex),r.update("pagesRotation",e.pagesRotation),r.update("pageHeight",e.pageHeight),r.update("pageWidth",e.pageWidth),r.update("rotation",e.rotation),r.update("rotatedPage",e.rotatedPage),r.update("viewMode",e.viewMode),e),Cover:e=>a.createElement(u,{...e,renderSpinner:t?.renderSpinner,store:r}),Thumbnails:a.useCallback((e=>a.createElement(d.Provider,{value:{renderSpinner:t?.renderSpinner||l}},a.createElement(L,{renderCurrentPageLabel:t?.renderCurrentPageLabel,renderThumbnailItem:e?.renderThumbnailItem,store:r,thumbnailDirection:e?.thumbnailDirection||n.Vertical,thumbnailWidth:t?.thumbnailWidth||100}))),[i])}};
